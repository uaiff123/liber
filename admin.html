<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Admin ¬∑ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï 2</title>
    <link rel="icon" type="image/png" href="img/logo2.png">
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ===== CSS ‡πÄ‡∏î‡∏¥‡∏° (‡πÇ‡∏ó‡∏ô‡∏ó‡∏≠‡∏á/‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•) ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f3f1e1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            overflow-x: hidden;
            line-height: 1.5;
        }

        :root {
            --gold: #C09239;
            --gold-light: #D4B15F;
            --brown: #5A4A2E;
            --cream: #FFF5E0;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f5f5f5; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
        * { scrollbar-width: thin; scrollbar-color: var(--gold) #f5f5f5; }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.98);
            border-bottom: 1px solid rgba(192,146,57,0.15);
            padding: 0.8rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--gold);
        }

        .logo img {
            height: 48px;
            width: 48px;
            object-fit: contain;
        }

        .home-link a {
            text-decoration: none;
            color: var(--brown);
            font-weight: 600;
            background: var(--cream);
            padding: 0.5rem 1.2rem;
            border-radius: 30px;
            border: 1px solid rgba(192,146,57,0.3);
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .home-link a:hover {
            background: #ffeac2;
            transform: scale(1.03);
        }

        .admin-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0 1.5rem;
        }

        .admin-header h1 {
            font-size: 2.2rem;
            color: #9C7A3A;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-badge {
            background: linear-gradient(145deg, var(--gold), var(--gold-light));
            color: white;
            padding: 0.3rem 1rem;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* ===== ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î ===== */
        .form-section {
            background: linear-gradient(145deg, #ffffff, #fffdf8);
            border: 1.5px solid rgba(192,146,57,0.2);
            border-radius: 28px;
            padding: 1rem 1.2rem;
            box-shadow: 0 6px 14px rgba(153,115,40,0.05);
            margin-bottom: 1.5rem;
        }

        .form-section h2 {
            color: var(--brown);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: #7A5C2A;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.5rem 0.8rem;
            border: 1.5px solid rgba(192,146,57,0.2);
            border-radius: 14px;
            font-size: 0.9rem;
            background: white;
            transition: 0.2s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(192,146,57,0.1);
        }

        .btn {
            background: linear-gradient(145deg, var(--gold), var(--gold-light));
            border: none;
            border-radius: 40px;
            padding: 0.6rem 1.2rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 0.9rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(192,146,57,0.3);
        }

        .btn-secondary {
            background: var(--cream);
            color: var(--brown);
            border: 1px solid rgba(192,146,57,0.3);
        }

        .btn-secondary:hover {
            background: #ffeaca;
        }

        .btn-danger {
            background: #e4c2a1;
            color: #5a3e1b;
        }

        .btn-sm {
            padding: 0.3rem 0.9rem;
            font-size: 0.8rem;
            border-radius: 30px;
        }

        /* Rating */
        .rating-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }
        .rating-item {
            flex: 1 1 85px;
            background: rgba(192,146,57,0.06);
            border: 2px solid rgba(192,146,57,0.2);
            border-radius: 24px;
            padding: 0.45rem 0.3rem;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 600;
            color: #5A4A2E;
            font-size: 0.8rem;
        }
        .rating-item.active {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
            box-shadow: 0 3px 8px rgba(192,146,57,0.3);
        }
        .rating-text {
            font-size: 0.8rem;
        }

        .time-user-row, .year-major-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
        }

        @media (max-width: 640px) {
            .time-user-row, .year-major-row {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
        }

        #duration-display {
            background: rgba(192,146,57,0.04);
            padding: 0.5rem 0.8rem;
            border-radius: 14px;
            font-weight: 500;
            color: #5A4A2E;
            border: 1px dashed rgba(192,146,57,0.3);
            font-size: 0.85rem;
        }

        .table-section {
            background: white;
            border-radius: 32px;
            padding: 1.8rem;
            border: 1.5px solid rgba(192,146,57,0.2);
            box-shadow: 0 8px 18px rgba(153,115,40,0.06);
            margin-top: 1.5rem;
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .table-header h3 {
            color: var(--brown);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: auto;
        }

        .export-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-box {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-box input {
            padding: 0.5rem 1rem;
            border: 1.5px solid rgba(192,146,57,0.2);
            border-radius: 40px;
            min-width: 200px;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            text-align: left;
            padding: 0.9rem 0.75rem;
            background: rgba(192,146,57,0.08);
            color: #5A4A2E;
            font-weight: 600;
            white-space: nowrap;
        }

        td {
            padding: 0.9rem 0.75rem;
            border-bottom: 1px solid rgba(192,146,57,0.1);
            vertical-align: middle;
            white-space: nowrap;
        }

        tr:hover td {
            background: rgba(255,245,224,0.3);
        }

        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            padding: 6px;
            border-radius: 8px;
            transition: 0.2s;
            color: #7A5C2A;
        }

        .action-btn.delete:hover {
            background: rgba(200,80,80,0.1);
            color: #b34a4a;
        }

        .status-badge {
            background: rgba(192,146,57,0.1);
            padding: 0.25rem 0.8rem;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #7A5C2A;
            display: inline-block;
        }

        .rating-stars {
            color: var(--gold);
            letter-spacing: 2px;
        }

        .empty-message {
            text-align: center;
            padding: 2rem;
            color: #9C7A3A;
            font-size: 1.1rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(3px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 32px;
            max-width: 500px;
            width: 90%;
            border: 2px solid var(--gold);
        }

        .modal-content h3 {
            color: var(--brown);
            margin-bottom: 1.5rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .bg-bubble {
            position: fixed;
            border-radius: 50%;
            background: rgba(192, 146, 57, 0.04);
            pointer-events: none;
            z-index: -1;
            animation: bubbleMove 22s linear infinite;
        }

        @keyframes bubbleMove {
            0% { transform: translateY(100vh) scale(0.3); opacity: 0; }
            20% { opacity: 0.2; }
            80% { opacity: 0.2; }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }

        @media (max-width: 768px) {
            .admin-header h1 { font-size: 1.8rem; }
            .table-header { flex-direction: column; align-items: start; }
            .export-actions { width: 100%; justify-content: flex-start; }
            .filter-box { width: 100%; }
            .filter-box input { width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Bubbles Background -->
    <div id="bubbles-container"></div>

    <!-- Header -->
    <header>
        <div class="container">
            <nav class="navbar">
                <div class="logo">
                    <img src="img/logo2.png" alt="logo"> Admin
                </div>
                <div class="home-link">
                    <a href="home.html"><i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Admin Header -->
        <div class="admin-header">
            <h1>
                <i class="fas fa-cog" style="color: #C09239;"></i> 
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï 2
            </h1>
            <span class="admin-badge"><i class="fas fa-shield-alt"></i> ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</span>
        </div>

        <!-- ========== ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ä‡πâ room_logs) ========== -->
        <div class="form-section">
            <h2><i class="fas fa-clipboard-list"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á</h2>
            
            <form id="survey-form">
                <!-- ‡∏´‡πâ‡∏≠‡∏á -->
                <div class="form-group">
                    <label for="room-name"><i class="fas fa-door-open"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</label>
                    <select id="room-name" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                        <option value="‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï 2" selected>‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï 2</option>
                        <option value="‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï 1">‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï 1</option>
                        <option value="‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° A">‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° A</option>
                        <option value="‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î">‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</option>
                    </select>
                </div>

                <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å -->
                <div style="margin-bottom: 0.8rem;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.6rem;">
                        <i class="fas fa-clock" style="color: var(--gold); font-size: 0.95rem;"></i>
                        <span style="font-weight: 600; color: var(--brown); font-size: 1rem;">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</span>
                    </div>
                    <div class="time-user-row">
                        <div class="form-group">
                            <label for="entry-time"><i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</label>
                            <input type="time" id="entry-time" required>
                        </div>
                        <div class="form-group">
                            <label for="exit-time"><i class="fas fa-sign-out-alt"></i> ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
                            <input type="time" id="exit-time" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-hourglass-half"></i> ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <div id="duration-display">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</div>
                    </div>
                </div>

                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
                <div style="margin-bottom: 0.8rem;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.6rem;">
                        <i class="fas fa-user-graduate" style="color: var(--gold); font-size: 0.95rem;"></i>
                        <span style="font-weight: 600; color: var(--brown); font-size: 1rem;">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                    </div>
                    <div class="time-user-row">
                        <div class="form-group">
                            <label for="fullname"><i class="fas fa-user"></i> ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="fullname" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ ‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•" required>
                        </div>
                        <div class="form-group">
                            <label for="student-id"><i class="fas fa-id-card"></i> ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                            <input type="text" id="student-id" placeholder="11 ‡∏´‡∏•‡∏±‡∏Å" required>
                        </div>
                    </div>
                    <div class="year-major-row">
                        <div class="form-group">
                            <label for="year"><i class="fas fa-layer-group"></i> ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</label>
                            <select id="year" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</option>
                                <option value="‡∏õ‡∏ß‡∏ä 1">‡∏õ‡∏ß‡∏ä 1</option>
                                <option value="‡∏õ‡∏ß‡∏ä 2">‡∏õ‡∏ß‡∏ä 2</option>
                                <option value="‡∏õ‡∏ß‡∏ä 3">‡∏õ‡∏ß‡∏ä 3</option>
                                <option value="‡∏õ‡∏ß‡∏™ 1">‡∏õ‡∏ß‡∏™ 1</option>
                                <option value="‡∏õ‡∏ß‡∏™ 2">‡∏õ‡∏ß‡∏™ 2</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="major"><i class="fas fa-book-open"></i> ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
                            <select id="major" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ --</option>
                                <option value="‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                                <option value="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à">‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</option>
                                <option value="‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á</option>
                                <option value="‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå">‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</option>
                                <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡∏•">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡∏•</option>
                                <option value="‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°">‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°</option>
                                <option value="‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•">‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•</option>
                                <option value="‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏µ‡∏Å">‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏µ‡∏Å</option>
                                <option value="‡∏ä‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á">‡∏ä‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à (‡πÉ‡∏ä‡πâ class active) -->
                <div style="margin-bottom: 0.8rem;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem;">
                        <i class="fas fa-star" style="color: var(--gold); font-size: 0.95rem;"></i>
                        <span style="font-weight: 600; color: var(--brown); font-size: 1rem;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à</span>
                    </div>
                    
                    <div class="rating-container" id="rating-container">
                        <div class="rating-item" data-rating="1">
                            <div class="rating-text">‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏à (1)</div>
                        </div>
                        <div class="rating-item" data-rating="2">
                            <div class="rating-text">‡∏û‡∏≠‡πÉ‡∏ä‡πâ (2)</div>
                        </div>
                        <div class="rating-item" data-rating="3">
                            <div class="rating-text">‡∏û‡∏≠‡πÉ‡∏à (3)</div>
                        </div>
                        <div class="rating-item" data-rating="4">
                            <div class="rating-text">‡∏û‡∏≠‡πÉ‡∏à‡∏°‡∏≤‡∏Å (4)</div>
                        </div>
                        <div class="rating-item" data-rating="5">
                            <div class="rating-text">‡∏û‡∏≠‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (5)</div>
                        </div>
                    </div>
                    <input type="hidden" id="satisfaction-rating" required>
                </div>

                <!-- ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ -->
                <div style="margin-bottom: 0.8rem;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.4rem;">
                        <i class="fas fa-comment-alt" style="color: var(--gold); font-size: 0.95rem;"></i>
                        <span style="font-weight: 600; color: var(--brown); font-size: 1rem;">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</span>
                    </div>
                    <div class="form-group">
                        <textarea id="suggestion" placeholder="‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" rows="2"></textarea>
                    </div>
                </div>

                <div style="display: flex; gap: 0.8rem; margin-top: 0.5rem; flex-wrap: wrap;">
                    <button type="submit" class="btn" id="submit-survey-btn">
                        <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à
                    </button>
                    <button type="button" class="btn btn-secondary" id="reset-survey-btn">
                        <i class="fas fa-undo-alt"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                    </button>
                </div>
            </form>
        </div>

        <!-- ========== ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å room_logs ========== -->
        <div class="table-section">
            <div class="table-header">
                <h3><i class="fas fa-list-ul"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (room_logs)</h3>
                <div class="export-actions">
                    <button class="btn btn-secondary btn-sm" onclick="exportCSV()" title="‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV"><i class="fas fa-file-csv"></i> CSV</button>
                    <button class="btn btn-secondary btn-sm" onclick="exportSQL()" title="‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å SQL INSERT"><i class="fas fa-database"></i> SQL</button>
                    <button class="btn btn-secondary btn-sm" onclick="exportCLI()" title="‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Supabase CLI"><i class="fas fa-terminal"></i> CLI</button>
                </div>
                <div class="filter-box">
                    <i class="fas fa-search" style="color: #C09239;"></i>
                    <input type="text" id="filter-room" placeholder="‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á...">
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table id="logs-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>‡∏´‡πâ‡∏≠‡∏á</th>
                            <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</th>
                            <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                            <th>‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ</th>
                            <th>‡∏™‡∏≤‡∏Ç‡∏≤</th>
                            <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                            <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr><td colspan="12" class="empty-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö -->
    <div class="modal" id="delete-modal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-triangle" style="color: #b34a4a;"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
            <p id="delete-message" style="margin-bottom: 1rem;">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancel-delete">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-danger" id="confirm-delete">‡∏•‡∏ö</button>
            </div>
        </div>
    </div>

    <script>
        // üîß ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ Supabase (‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
        const SUPABASE_URL = 'https://rbyvxhtntwktcdxligvi.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_PYcF7YtKZKk_luUr0Ifjvg_dpwRKWlT';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ----------------------------------------------------
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤ "HH:MM" ‡πÄ‡∏õ‡πá‡∏ô ISO timestamp ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (timezone local)
        // ----------------------------------------------------
        function combineDateAndTime(timeStr) {
            if (!timeStr) return null;
            const [hours, minutes] = timeStr.split(':').map(Number);
            const now = new Date();
            now.setHours(hours, minutes, 0, 0);  // set ‡∏ï‡∏≤‡∏° local time
            return now.toISOString();             // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô UTC ISO string
        }

        // ----------------------------------------------------
        // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á room_logs)
        // ----------------------------------------------------
        function initSurveyForm() {
            const entryTime = document.getElementById('entry-time');
            const exitTime = document.getElementById('exit-time');
            const durationDisplay = document.getElementById('duration-display');

            function calculateDuration() {
                if (entryTime.value && exitTime.value) {
                    const entry = entryTime.value.split(':');
                    const exit = exitTime.value.split(':');
                    const entryDate = new Date(2000, 0, 1, entry[0], entry[1]);
                    let exitDate = new Date(2000, 0, 1, exit[0], exit[1]);
                    if (exitDate < entryDate) exitDate.setDate(exitDate.getDate() + 1);
                    const diffMs = exitDate - entryDate;
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffMinutes = Math.floor((diffMs % 3600000) / 60000);
                    durationDisplay.textContent = `${diffHours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${diffMinutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
                } else {
                    durationDisplay.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å';
                }
            }

            entryTime.addEventListener('change', calculateDuration);
            exitTime.addEventListener('change', calculateDuration);

            // ----- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Rating (active class) -----
            const ratingItems = document.querySelectorAll('.rating-item');
            const ratingHidden = document.getElementById('satisfaction-rating');

            ratingItems.forEach(item => {
                item.addEventListener('click', function() {
                    ratingItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    ratingHidden.value = this.dataset.rating;
                });
            });

            // ----- ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° -----
            const surveyForm = document.getElementById('survey-form');
            surveyForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                if (!ratingHidden.value) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à');
                    return;
                }

                // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå room_logs
                const surveyData = {
                    room_name: document.getElementById('room-name').value,
                    check_in: combineDateAndTime(entryTime.value),
                    check_out: combineDateAndTime(exitTime.value),
                    full_name: document.getElementById('fullname').value.trim(),
                    student_id: document.getElementById('student-id').value.trim(),
                    year_level: document.getElementById('year').value,
                    major: document.getElementById('major').value,
                    satisfaction: parseInt(ratingHidden.value),
                    comment: document.getElementById('suggestion').value.trim() || null,
                    created_at: new Date()
                };

                const { error } = await supabase
                    .from('room_logs')
                    .insert([surveyData]);

                if (error) {
                    console.error(error);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à: ' + error.message);
                } else {
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    surveyForm.reset();
                    durationDisplay.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å';
                    ratingItems.forEach(i => i.classList.remove('active'));
                    ratingHidden.value = '';
                }
            });

            // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('reset-survey-btn').addEventListener('click', () => {
                surveyForm.reset();
                durationDisplay.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å';
                ratingItems.forEach(i => i.classList.remove('active'));
                ratingHidden.value = '';
            });
        }

        // ----------------------------------------------------
        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö room_logs (‡∏î‡∏π, ‡∏•‡∏ö, Export)
        // ----------------------------------------------------
        let deleteId = null;

        async function loadRoomLogs(filterRoom = '') {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '<tr><td colspan="12" class="empty-message"><i class="fas fa-spinner fa-pulse"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';

            let query = supabase
                .from('room_logs')
                .select('*')
                .order('created_at', { ascending: false });

            if (filterRoom.trim() !== '') {
                query = query.ilike('room_name', `%${filterRoom}%`);
            }

            const { data, error } = await query;

            if (error) {
                console.error(error);
                tableBody.innerHTML = `<tr><td colspan="12" class="empty-message"><i class="fas fa-exclamation-circle"></i> ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</td></tr>`;
                return;
            }

            if (!data || data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="12" class="empty-message"><i class="fas fa-inbox"></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                return;
            }

            let html = '';
            data.forEach(row => {
                let stars = '';
                const rating = row.satisfaction ? parseInt(row.satisfaction) : 0;
                for (let i = 1; i <= 5; i++) stars += i <= rating ? '‚òÖ' : '‚òÜ';

                // ‡πÅ‡∏™‡∏î‡∏á check_in/out ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ HH:MM (‡∏ï‡∏±‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà)
                const checkIn = row.check_in ? new Date(row.check_in).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', hour12: false }) : '-';
                const checkOut = row.check_out ? new Date(row.check_out).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', hour12: false }) : '-';
                const created = row.created_at ? new Date(row.created_at).toLocaleString('th-TH', {
                    day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit'
                }) : '-';

                html += `<tr>
                    <td><span class="status-badge">${row.id}</span></td>
                    <td>${escapeHtml(row.room_name || '')}</td>
                    <td>${escapeHtml(checkIn)}</td>
                    <td>${escapeHtml(checkOut)}</td>
                    <td>${escapeHtml(row.full_name || '')}</td>
                    <td>${escapeHtml(row.student_id || '')}</td>
                    <td>${escapeHtml(row.year_level || '')}</td>
                    <td>${escapeHtml(row.major || '')}</td>
                    <td><span class="rating-stars">${stars}</span></td>
                    <td>${escapeHtml(row.comment || '')}</td>
                    <td style="font-size: 0.85rem;">${created}</td>
                    <td class="action-btns">
                        <button class="action-btn delete" onclick="showDeleteModal('${row.id}')" title="‡∏•‡∏ö"><i class="fas fa-trash-alt"></i></button>
                    </td>
                </tr>`;
            });
            tableBody.innerHTML = html;
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        window.showDeleteModal = function(id) {
            deleteId = id;
            document.getElementById('delete-message').innerHTML = `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ID <strong>${id}</strong>?`;
            document.getElementById('delete-modal').classList.add('active');
        };

        async function deleteRoomRecord() {
            if (!deleteId) return;
            const { error } = await supabase.from('room_logs').delete().eq('id', deleteId);
            if (error) {
                console.error(error);
                alert('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            } else {
                closeDeleteModal();
                loadRoomLogs(document.getElementById('filter-room').value.trim());
            }
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.remove('active');
            deleteId = null;
        }

        // ---------- EXPORT 3 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ----------
        function downloadFile(content, fileName, mimeType = 'text/plain') {
            const blob = new Blob([content], { type: `${mimeType};charset=utf-8` });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
            URL.revokeObjectURL(link.href);
        }

        // CSV
        window.exportCSV = async function() {
            const { data, error } = await supabase.from('room_logs').select('*').order('created_at', { ascending: false });
            if (error) { alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message); return; }
            if (!data.length) { alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å'); return; }
            
            const headers = ['id','room_name','check_in','check_out','full_name','student_id','year_level','major','satisfaction','comment','created_at'];
            const rows = data.map(row => [
                row.id,
                row.room_name || '',
                row.check_in || '',
                row.check_out || '',
                row.full_name || '',
                row.student_id || '',
                row.year_level || '',
                row.major || '',
                row.satisfaction || '',
                row.comment ? `"${row.comment.replace(/"/g, '""')}"` : '',
                row.created_at || ''
            ]);
            const csvContent = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            downloadFile(csvContent, 'room_logs_export.csv', 'text/csv');
        };

        // SQL INSERT
        window.exportSQL = async function() {
            const { data, error } = await supabase.from('room_logs').select('*').order('created_at', { ascending: false });
            if (error) { alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message); return; }
            if (!data.length) { alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å'); return; }
            
            let sql = `-- SQL INSERT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á room_logs\n-- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${new Date().toLocaleString('th-TH')}\n\n`;
            sql += `INSERT INTO room_logs (id, room_name, check_in, check_out, full_name, student_id, year_level, major, satisfaction, comment, created_at) VALUES\n`;
            const values = data.map(row => {
                const comment = row.comment ? `'${row.comment.replace(/'/g, "''")}'` : 'NULL';
                const created = row.created_at ? `'${row.created_at}'` : 'NULL';
                return `(${row.id}, '${row.room_name || ''}', '${row.check_in || ''}', '${row.check_out || ''}', '${row.full_name || ''}', '${row.student_id || ''}', '${row.year_level || ''}', '${row.major || ''}', ${row.satisfaction || 'NULL'}, ${comment}, ${created})`;
            });
            sql += values.join(',\n') + ';';
            downloadFile(sql, 'room_logs_export.sql', 'application/sql');
        };

        // CLI ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
        window.exportCLI = async function() {
            const projectRef = 'rbyvxhtntwktcdxligvi';
            const cliCommand = `# ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á room_logs ‡∏î‡πâ‡∏ß‡∏¢ Supabase CLI
# ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Supabase CLI ‡πÅ‡∏•‡∏∞ login ‡∏Å‡πà‡∏≠‡∏ô (https://supabase.com/docs/guides/cli)
# ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏ô terminal ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏ñ‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ñ‡∏π‡∏Å link ‡πÅ‡∏•‡πâ‡∏ß
supabase db dump -t room_logs > room_logs_backup.sql

# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏£‡∏∞‡∏ö‡∏∏ --db-url (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö DB password)
# supabase db dump --db-url postgresql://postgres:[YOUR_PASSWORD]@db.${projectRef}.supabase.co:5432/postgres -t room_logs > room_logs_backup.sql

# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡πÉ‡∏ä‡πâ pg_dump (‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ direct connection)
# pg_dump --no-owner --no-acl --table=room_logs postgresql://[USER]:[PASS]@db.${projectRef}.supabase.co:5432/postgres > room_logs_backup.sql

# ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleString('th-TH')}
`;
            downloadFile(cliCommand, 'export_via_cli.txt', 'text/plain');
        };

        // ----------------------------------------------------
        // 3. Realtime subscription ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö room_logs
        // ----------------------------------------------------
        function subscribeRoomLogs() {
            supabase
                .channel('room_logs_changes')
                .on('postgres_changes', { event: '*', schema: 'public', table: 'room_logs' }, () => {
                    loadRoomLogs(document.getElementById('filter-room').value.trim());
                })
                .subscribe();
        }

        // ----------------------------------------------------
        // 4. ‡∏ü‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
        // ----------------------------------------------------
        function initBubbles() {
            const c = document.getElementById('bubbles-container');
            if (!c) return;
            for (let i = 0; i < 4; i++) {
                setTimeout(() => {
                    let b = document.createElement('div');
                    b.className = 'bg-bubble';
                    let s = Math.random() * 55 + 25;
                    b.style.width = s + 'px';
                    b.style.height = s + 'px';
                    b.style.left = Math.random() * 100 + '%';
                    b.style.animationDuration = (Math.random() * 12 + 18) + 's';
                    b.style.animationDelay = (Math.random() * 5) + 's';
                    c.appendChild(b);
                    setTimeout(() => b.remove(), 24000);
                }, i * 700);
            }
        }

        // ----------------------------------------------------
        // 5. Event listeners ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        // ----------------------------------------------------
        document.addEventListener('DOMContentLoaded', async function() {
            initSurveyForm();
            await loadRoomLogs();
            subscribeRoomLogs();

            document.getElementById('cancel-delete').addEventListener('click', closeDeleteModal);
            document.getElementById('confirm-delete').addEventListener('click', deleteRoomRecord);
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) closeDeleteModal();
            });

            document.getElementById('filter-room').addEventListener('input', (e) => {
                loadRoomLogs(e.target.value.trim());
            });

            initBubbles();
            setInterval(initBubbles, 10000);
        });
    </script>
</body>
</html>
